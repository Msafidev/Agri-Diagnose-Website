{% extends 'base.html' %}
{% block tittle%} Start | Agri-Diagnose-Kenya{% endblock %}
{% load static %}
{% block content %}

<div class="container my-5">
    <h2 class="text-center mb-4">Start Crop Disease Diagnosis</h2>

    <div class="card shadow">
        <div class="card-body">
            <div class="upload-section text-center">
                <label class="btn btn-outline-danger btn-lg">
                    <i class="fas fa-upload"></i> Upload Leaf Image
                    <input type="file" id="fileInput" accept="image/*" style="display:none;">
<!--                    <input type="file" name="image" id="hiddenImage" style="display:none;">-->
                </label>
                <div class="mt-3">
                    <img id="preview" src="" alt="Preview" class="img-fluid rounded" style="max-height:300px; display:none;">
                </div>
            </div>

            <div id="loader" class="text-center my-4" style="display:none;">
                <div class="spinner-border text-danger" role="status"></div>
                <p class="mt-2">AI is analyzing your crop...</p>
            </div>

            <div class="text-center mt-4">
                <button class="btn btn-success me-3" onclick="getLocation()">
                    Get My Location
                </button>
                <button class="btn btn-danger" id="predictBtn" onclick="runPrediction()" disabled>
                    Run Diagnosis
                </button>
            </div>

            <div id="result" class="mt-4" style="display:none;"></div>

            <!-- Hidden form to save diagnosis -->
            <form id="saveForm" method="POST" action="{% url 'save_diagnosis' %}" enctype="multipart/form-data" style="display:none;">
                {% csrf_token %}
                <input type="hidden" name="predicted_label" id="predicted_label">
                <input type="hidden" name="confidence" id="confidence">
                <input type="hidden" name="lat" id="latField">
                <input type="hidden" name="lon" id="lonField">
                <input type="file" name="image" id="hiddenImage">
            </form>

            <div id="map" style="height: 300px; margin-top: 20px; border-radius: 8px; display:none;"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}

<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/tensorflow/4.22.0/tf.min.js"></script>-->
<!--<script>-->
<!--        const MODEL_URL = "{% static 'models/models.json' %}";-->
<!--        const LABELS_URL = "{% static 'models/labels.json' %}";-->
<!--    </script>-->
    <script src="{% static 'js/main.js' %}"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

{% endblock %}